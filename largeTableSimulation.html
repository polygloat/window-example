<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<div id="loading" style="position: fixed; top:0; left: 0; width: 100%; height: 100%;
            background-color: white; display: flex; align-items: center; justify-content: center;">
    Loading...
</div>

<h1>??aaa:param:data,param2:data2\,with\:escaped\,stuff}}</h1>

<div id="target"></div>

<script src="../../polygloat-js/dist/polygloat.window.js"></script>
<script>const pg = new polygloat.Polygloat({
    apiKey: "kld65v4h4729mh48lcdu2jdcv3",
    apiUrl: "http://localhost:8080",
    defaultLanguage: "aaa",
    inputPrefix: "??",
    inputSuffix: "}}"
});
pg.run().then(() => {
    pg.handleSubtree(document.body).then(() => {
        //polygloat is set! Lets remove loading indicator!
        document.getElementById("loading").style.display = "none";
    });
});
</script>

<script>
    const makeid = (length) => {
        var result = '';
        var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        var charactersLength = characters.length;
        for (var i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        return result
    };

    const genereateCell = (inner) => {
        let td = document.createElement("td");
        td.innerHTML = inner || makeid(20);
        return td;
    };

    const generateRow = (cols) => {
        let tr = document.createElement("tr");
        for (let i = 0; i < cols; i++) {
            tr.append(genereateCell());
        }
        return tr;
    };

    const generateHeader = (cols) => {
        let htmlTableRowElement = document.createElement("tr");
        for (let i = 0; i < cols; i++) {
            htmlTableRowElement.append(genereateCell("??aaa:param:data,param2:data2\\,with\\:escaped\\,stuff}}"))
        }
        return htmlTableRowElement;
    };

    const generateTable = (rows = 100, cols = 100) => {
        let table = document.createElement("table");
        table.append(generateHeader(cols));
        for (let i = 0; i < rows; i++) {
            table.append(generateRow(cols));
        }
        return table;
    };

    /* new Promise(resolve => {
         setTimeout(() => resolve(generateTable()), 1000);
     }).then(t => document.getElementById("target").append(t));
     */
    document.getElementById("target").append(generateTable(1000, 100));
</script>

</body>
</html>